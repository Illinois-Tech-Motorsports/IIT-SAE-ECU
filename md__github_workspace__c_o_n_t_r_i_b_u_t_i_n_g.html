<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SAE Teensy ECU: How To Contribute</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="DoxyLogo.png"/></td>
  <td id="projectalign">
   <div id="projectname">SAE Teensy ECU
   </div>
   <div id="projectbrief">IIT SAE Microcontroller programming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__github_workspace__c_o_n_t_r_i_b_u_t_i_n_g.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How To Contribute </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >If you are unfamiliar with Git, CMake, or VSCode, please read through this guide thoroughly.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Before you begin</h1>
<p >This repository is for students that are part of the SAE club at Illinois Tech.</p>
<p >If you are here then that probably means you have joined the club and are interested in programming the microcontrollers that our car uses.</p>
<p >This side of the software sub-team works closely with different electrical sub systems of the car. This includes things like the Motor controllers, Accumulator Management System (AMS), and sensors such as the steering wheel, pedals, and brake pressure.</p>
<p >Another major part of this project communicates with an Android phone app, which is currently being used as a dashboard for the car. If you would like to take a look at the Android app instead, look for the appropriate repository on the <a href="https://github.com/Illinois-Tech-Motorsports">Illinois Tech Motorsports</a> organization page on github. The project should be named <em>Dashboard</em> followed by the most recent year.</p>
<p >The main part of this project is written in C++17 and is currently setup to only compile on Windows. Various scripts used by the compilation process are written in python 3.10.</p>
<p >This project is meant to be used with <a href="https://code.visualstudio.com/">VSCode</a> as all the tasks and formatting is taken care of through local settings. The rest of this document assumes you are using VSCode.</p>
<p ><b>Before continuing, be sure to follow the <a href="README.md#software">Software</a> and <a href="README.md#setup">Setup</a> section of the <a href="README.md#software">README</a>.</b></p>
<h1><a class="anchor" id="autotoc_md2"></a>
Familiarizing Yourself</h1>
<p >If you are having trouble with anything here, first double check you read it correctly, and if that doesn't work, try looking it up, and if that don't work, ask someone that you think might know, to help you.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
The Environment</h1>
<p >Here are some things that you should do which should help you familiarize yourself with scripts, extensions, and tasks that are often used and to ensure that everything is working.</p>
<p >Although you already should have from the <a href="README.md#setup">README</a> setup section, make sure you have also cloned the <a href="https://github.com/LeHuman/TeensyToolchain">TeensyToolchain</a> repo using <code>git clone</code>, and put it next to this project folder.</p>
<p >To thoroughly follow this guide, ensure you have 1-2 Teensies connected to your pc. They <b>must</b> be the same model, either <code>3.6</code>, <code>4.0</code>, or <code>4.1</code>.</p>
<ol type="1">
<li><p class="startli">When you first open this project in VSCode, it might recommend you to install some extensions, install them. If it does not recommend them look into the <code>.vscode/extensions.json</code> file and search for each item under the <code>recommendations</code> section using the extensions tab which is on the left side bar in VSCode.</p>
<p class="startli">By default, The top left icon in VSCode shows the open editors and files in your workspace. The one below that is source control.</p>
<p class="startli"><img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/VSIcons.png" alt="The source control tab" class="inline"/></p>
<p class="startli">We will not get into how <a href="https://git-scm.com/">git</a> works, you should learn about that elsewhere. In any case, know that this is where you can commit changes to the repository without using a terminal, meaning, you can upload changes to the online repository or just see what changes you have made in general.</p>
<p class="startli">If something like this shows up instead...</p>
<p class="startli"><img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/nogit.png" alt="nogit" class="inline"/></p>
<p class="startli">This means you either did not use <code>git clone</code> to download this repository or you don't actually have the folder open in VSCode. Just in case, to open a folder, look at the top bar and do <code>File &gt; Open Folder</code> and open the root folder of this project.</p>
<p class="startli">On the bottom taskbar in VSCode, towards the far left, there is a similar smaller icon that which should look like <img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/master.png" alt="master" class="inline"/> , this is your current branch.</p>
<p class="startli">If you understand <a href="https://git-scm.com/">git</a>, it may be best that you work on a separate fork and create pull requests as you work on the repository.</p>
<p class="startli">If nothing about branches, commits, forks, or whatever does not make sense, that is okay. Just know that, for now, you cannot upload any changes and everything you do will only be saved locally.</p>
<p class="startli">One caveat to this, however, is if there is an update to the online repository you need to undo all changes and then run <code>git pull</code> in the repository folder. Alternatively, click on <img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/Reload.png" alt="reload" class="inline"/> which is at the bottom left corner.</p>
<p class="startli">One additional note, you can click on <img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/master.png" alt="master" class="inline"/> to switch to a testing branch, that is, you can switch to the testing version of this repository which should be used for testing. It is most likely the case that you should do this. Click on the icon and then click on <code>testing</code> when the popup shows up.</p>
</li>
<li>Run these <a href="https://code.visualstudio.com/Docs/editor/tasks">tasks</a>* in VSCode<ul>
<li><code>VS setup</code>: Setup VSCode configuration files<ul>
<li>There is a similar task that should run on startup called <code>ZZZZ</code>, VSCode might prompt you to allow running tasks on startup, allow it if that happens. <b>If your terminal did not open up and begin prompting you when you initally opened this repository folder, run this task.</b></li>
<li>When the prompt is asking for the <code>CORE_MODEL</code> choose what model teensy you have.</li>
<li>When the prompt is asking for a <code>COM</code> port, if you have your Teensies connected, it should show which ones are available**. Choose which teensy to be the front one and which teensy to be the back one***.</li>
<li>When the prompt is asking for the <code>LOGGING_OPTION</code> simply press <code>Enter</code> to choose the default option</li>
<li>When the prompt is asking for <code>GRAPH_ARG</code> set to <code>yes</code> or <code>no</code> depending if you want a plotter to show up when connecting to the teensy.</li>
</ul>
</li>
<li><code>Build</code>: Compile project<ul>
<li>A Terminal should open up running various commands and ending with the statement <code>Task Succeeded ✔</code></li>
</ul>
</li>
<li><code>Clean</code>: Clean up build files<ul>
<li>Same result as the <code>Build</code> task</li>
</ul>
</li>
<li><code>Shebang Both</code>****: Run all tasks required to program both connected Teensies ( for the prompts when the monitor task is run, select <code>FRONT_TEENSY_PORT</code>, and <code>Mapped</code> )<ul>
<li>You should see the terminal printing log information from the front Teensy</li>
</ul>
</li>
</ul>
</li>
<li>Open the <a href="https://illinois-tech-motorsports.github.io/IIT-SAE-ECU/">documentation website</a><ul>
<li>This will be useful later</li>
</ul>
</li>
</ol>
<ul>
<li>By default, pressing the combo <code>Ctrl + lShift + P</code> then typing and selecting <code>Tasks: Run Task</code> should give you a list of all the tasks listed in the <a href=".vscode/tasks.json">tasks.json</a> file. Alternatively, installing the <a href="https://marketplace.visualstudio.com/items?itemName=actboy168.tasks">Tasks</a> extension shows commonly used tasks on the bottom task bar in VSCode, as so.</li>
</ul>
<p ><img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/listedTasks.png" alt="How the bottom task bar should look like" class="inline"/></p>
<p >These tasks are used to help automate development.</p>
<p >** If <code>COM</code> ports are not showing up as available, find what <code>COM</code> port to use by doing the following.</p>
<p >In windows, these <code>COM</code> ports show up in the <a href="https://support.microsoft.com/en-us/windows/open-device-manager-a7f2db46-faaf-24f0-8b7b-9e4a6032fc8c">Device Manager</a>. There should only be one port per Teensy. These ports should look like <code>COMx</code> where <code>x</code> is a number.</p>
<p ><img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/COMPORTS.png" alt="What the COM PORTs might look like" class="inline"/></p>
<p >If there are no extra ports showing up, i.e. connecting or disconnecting a teensy doesn't change the number of ports, attempt to first program the teensy using <code>teensy.exe</code> or with the <code>Arduino</code> suite. Or ask someone for help.</p>
<p >*** If you only have one teensy, make it the front one and put whatever for the second.</p>
<p >**** If you only have one Teensy, only setup the front one and instead run <code>Shebang <a class="el" href="namespace_front.html" title="Name space used solely for front ECU logic.">Front</a></code>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
The Code</h1>
<p >Now that you have taken a look at what you will be <em>using</em> to program, lets look at <em>how</em> you should program.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Coding Conventions</h2>
<p >As stated before, this project mainly uses C++ and Python.</p>
<p >Both languages can be auto formatted by running the default combo of <code>lShift + lAlt + F</code>, otherwise pressing the combo <code>Ctrl + lShift + P</code> then typing and selecting <code>Format Document</code> should do the same. Note, however, that the style for python is less strict than for C++, the following only concerns when programming in C++.</p>
<ul>
<li><p class="startli">No new lines after an open bracket, this reduces the need for vertical screen space. Also, try reducing used vertical space wherever else you can.</p>
<div class="fragment"><div class="line">{C++}</div>
<div class="line">   If (true) { // Wrong ✖</div>
<div class="line"> </div>
<div class="line">       return;</div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   If (true) { // Correct ✔</div>
<div class="line">       return;</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">Favor readability. Limit the use of one liners. This also helps when debugging problems.</p>
<div class="fragment"><div class="line">{C++}</div>
<div class="line">   // Wrong ✖</div>
<div class="line">   return object.command(otherObj.eval(input / 126f) * 255);</div>
<div class="line"> </div>
<div class="line">   // Correct ✔</div>
<div class="line">   float fnlEval = otherObj.eval(input / 126f);</div>
<div class="line">   return object.command(fnlEval * 255);</div>
</div><!-- fragment --></li>
<li><a href="docs/html/_x_macros.html">X Macros</a> should be defined in a <code>.def</code> file within the same library folder.</li>
<li><a href="https://www.learncpp.com/cpp-tutorial/header-guards/">Header guards</a> should follow the format <code>__ECU_X_Y__</code> where <code>X</code> is the file name and <code>Y</code> is the file extension ( as this can be used with <code>.h</code>, <code>.hpp</code>, and <code>.def</code> files), the entire string should also be capitalized. <br  />
 e.g. <code>__ECU_LOGGING_H__</code></li>
</ul>
<p >Before committing changes, be sure you have at least auto formatted your file. You should, however, follow these guidelines as you are working on files.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Modularity</h2>
<p >A big idea behind this project is modularity. This means that if we want to program some new functionality it should be in the form of a library/module.</p>
<p >Each library should only focus on doing one thing and doing it well. They should not be hardcoded to fit our specific case, and should be as general as they can be. These libraries/modules are stored in the <code>libraries</code> folder. This library folder also stores third party libraries, those that we have taken from other repositories. Regardless, they work in the same way.</p>
<p >One caveat, however, is that some of the libraries do break this rule somewhat. For example, some libraries have it hardcoded to behave one way if they are on the front teensy and different otherwise. The file <a href="libraries/ECUGlobalConfig/ECUGlobalConfig.h">ECUGlobalConfig.h</a> denotes these <em>hardcoded</em> values, in the sense that the libraries are directly dependent on our situation. That situation being that we are currently using two Teensies which behave differently. Solving this issue is possible but has not been done.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Python Scripting</h2>
<p >The python portion of this project is somewhat neglected. As long as it seemed to work we just left it alone. This is especially true for the <a href="Pre_Build.py">Pre_Build.py</a> script. Not much is to be said beyond this, feel free to look into the scripts and improve upon them as you see fit.</p>
<p >If you want to know more about what the scripts do, look at the documentation website or open their file and read the top portion of comments.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Documentation</h2>
<p ><a href="https://www.doxygen.nl/index.html">Doxygen</a> is a program that is used to help generate documentation for this project. All of it's settings are in the <a href="docs/Doxyfile">Doxyfile</a>, refer to the <a href="https://www.doxygen.nl/index.html">Doxygen</a> website for more info.</p>
<p >In regards to the libraries that we have written, all of their headers have been documented using <a href="https://www.doxygen.nl/index.html">Doxygen</a>. The extension <a href="https://marketplace.visualstudio.com/items?itemName=Isaias.doxygen-pack">Doxygen Extensions</a> exist for VSCode. Use this extension to help easily create comments.</p>
<p >In short, the way Doxygen works is by reading specifically formatted comments. You can look at examples throughout the project, but we will look at the file <a href="libraries/State/State.h">State.h</a>.</p>
<p >Note that towards the top there is a multiline comment, this gives Doxygen info about the file itself.</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * @file State.h</div>
<div class="line"> * @author IR</div>
<div class="line"> * @brief State library</div>
<div class="line"> * @version 0.1</div>
<div class="line"> * @date 2020-11-11</div>
<div class="line"> * </div>
<div class="line"> * @copyright Copyright (c) 2022</div>
<div class="line"> * ...</div>
<div class="line"> */</div>
</div><!-- fragment --><p >The <code>@</code> symbol is used to denote what information you are giving, this is more important for functions.</p>
<p >Looking at the <code>notify</code> and <code>getLastState</code> function...</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * @brief Send a code to the next state</div>
<div class="line"> * </div>
<div class="line"> * @param notify code to send</div>
<div class="line"> */</div>
<div class="line">void notify(int notify);</div>
<div class="line"> </div>
<div class="line">/**</div>
<div class="line"> * @brief Get a pointer of the last state</div>
<div class="line"> * @note If the state machine has just started, this will return a nullptr</div>
<div class="line"> * @return State_t* pointer of last state</div>
<div class="line"> */</div>
<div class="line">State_t *getLastState();</div>
</div><!-- fragment --><p ><code>@brief</code> gives a brief description of the function <br  />
 <code>@note</code> gives us the option is give an optional extra note <br  />
 <code>@param</code> Tells us what the first parameter of the function should be <br  />
 <code>@return</code> Tells us what this function should return</p>
<p >The extension should help with auto generating these symbols, just begin creating a multiline comment above a function and it should generate it for you.</p>
<p >If you wish to remove a part of code from documentation surround the code with the following comments. This is mostly used to omit the actual source files from documentation, as currently only header files are documented with Doxygen.</p>
<div class="fragment"><div class="line">// @cond</div>
<div class="line">int dontDocumentMe[4];</div>
<div class="line"> </div>
<div class="line">void dontDocumentThis(void);</div>
<div class="line"> </div>
<div class="line">void orThis(void);</div>
<div class="line">// @endcond</div>
</div><!-- fragment --><p >You do not have to do anything beyond this. If you wish, however, you can install <a href="https://www.doxygen.nl/index.html">Doxygen</a> and compile the website locally. However, this is automatically done on GitHub to generate the website online.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Further Reading</h1>
<p >You will need to look through the documentation to get a more detailed description of what all the libraries do, as you should not work on something that you do not understand. This documentation attempts to explain a lot of how these underlying libraries work. Of course, as this project is, <em>hopefully</em>, expanded on, feel free to improve this documentation.</p>
<p >I strongly recommend at least learning how logging works, as logging is used basically throughout this entire project, this is under <code>Classes &gt; Class List &gt; Log_t &gt; Detailed Description</code>. Also, take a look at the <code><a class="el" href="_pre___build_8py.html" title="This script preprocesses source files for use with Log_t.">Pre_Build.py</a></code> file under the <code>See also</code> part, this is also a major part of how logging works.</p>
<p >Other commonly used libraries are the <a class="el" href="namespace_canbus.html" title="Canbus functionality. Refer to Canbus.h for more info.">Canbus</a> and <a class="el" href="namespace_pins.html" title="Get and set values to predefined pins.">Pins</a> libs. These deal with communicating over <a class="el" href="namespace_canbus.html" title="Canbus functionality. Refer to Canbus.h for more info.">Canbus</a> and interacting the the GPIO pins respectively. Regardless, as you work on this project, hopefully you find this documentation to be helpful.</p>
<p >At this point ( especially if you have access to an Teensy ), attempt to first make some basic changes with the libraries. like use the logging library in the <a href="src/Front.cpp">Front::run</a> function and make it print something out, or use the pin library to turn the in-built led on and off. Of course, don't actually commit these changes to the repository.</p>
<p >Actually, you can completely undo changes to a file in the source tab in VSCode before you commit. This is in the source control tab, in case you needed to know that.</p>
<p ><img src="https://raw.githubusercontent.com/Illinois-Tech-Motorsports/IIT-SAE-ECU/master/Images/Contributing/discard.png" alt="Discard changes to a file" class="inline"/></p>
<p >You can also look at all of the source files for examples on everything. But just as a quick example for logging.</p>
<p >The statements</p>
<div class="fragment"><div class="line">LOG_TAG BruhID = &quot;Bruh&quot;;</div>
<div class="line">Log.w(BruhID, &quot;Moment&quot;, 2);</div>
</div><!-- fragment --><p >Should print in the terminal ( while monitoring the teensy over serial ) </p><blockquote class="doxtable">
<p >&zwj;[Bruh] [WARN] Moment 2 </p>
</blockquote>
<p>One final note is to take a look at the <a href="https://illinois-tech-motorsports.github.io/IIT-SAE-ECU/_infographics.html">infographics</a> page, here are listed various files that help visualize and document various designs used throughout this repository.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Moving Forward</h1>
<p >This repository was initially created with the intent that it would be used for multiple years after it's initial creation. Regardless, feel free to not use this repository and start something new. Use a new platform, use a new board, framework, whatever. Creating this repository from scratch taught us a lot as we are, after all, just students. In any case, this repository should work for the following years and its design should make it easy to add new functionality, so long as the teensy allows it. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
