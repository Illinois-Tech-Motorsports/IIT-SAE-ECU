<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SAE Teensy ECU: Log8</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="DoxyLogo.png"/></td>
  <td id="projectalign">
   <div id="projectname">SAE Teensy ECU
   </div>
   <div id="projectbrief">IIT SAE Microcontroller programming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__github_workspace__log8.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Log8 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="el" href="namespace_logging.html" title="Namespace to isolate Log_t struct.">Logging</a> protocol used by IIT Motorsports</p>
<ul>
<li>Log8<ul>
<li>Goals</li>
<li>Data streams</li>
<li>API</li>
<li>Telemetry<ul>
<li>Extensions</li>
<li>Usage Example</li>
<li>Encoding</li>
<li>CAN BUS</li>
<li>SDBC</li>
<li>Flow of data</li>
</ul>
</li>
<li>Log<ul>
<li>Extensions</li>
<li>Usage Example</li>
<li>Encoding</li>
<li>CAN BUS</li>
<li>Flow of data</li>
</ul>
</li>
<li>Debug I/O<ul>
<li>Extensions</li>
<li>Usage Example</li>
<li>Input</li>
<li>Output</li>
<li>Flow of data</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md22"></a>
Goals</h1>
<ul>
<li>Better standardize how telemetry values are sent and decoded</li>
<li>More static mapping, reduce the necessity to extract known information</li>
<li>Separate telemetry from logging</li>
</ul>
<h1><a class="anchor" id="autotoc_md23"></a>
Data streams</h1>
<p >The device should be capable of outputting three separate streams of data, where Telemetry and Log are also output on the <a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> line as deemed appropriate.</p>
<ul>
<li>Telemetry<ul>
<li>Raw encoded value data</li>
<li>Data is logged to .dat file</li>
<li>Uses TelemetryMap.json</li>
<li>Output to <a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> line</li>
</ul>
</li>
<li>Log<ul>
<li>Encoded string messages</li>
<li>information useful to logs<ul>
<li>such as info, warn, error, and fatal messages</li>
</ul>
</li>
<li>Data is logged to .log file</li>
<li>Uses LogMap.json</li>
<li>Output to <a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> line</li>
</ul>
</li>
<li>Debug I/O<ul>
<li>Direct un-logged ASCII stream of device information</li>
<li>Steam takes in input to debug calls<ul>
<li>Such as outputting the mapping file</li>
</ul>
</li>
</ul>
</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Telemetry   </th><th class="markdownTableHeadNone">Log   </th><th class="markdownTableHeadNone">Debug I/O    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Encoded   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✖    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Mapping   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✖    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Logged   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✖    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> Bus   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✖    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Serial Out   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✔    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Serial In   </td><td class="markdownTableBodyNone">✖   </td><td class="markdownTableBodyNone">✖   </td><td class="markdownTableBodyNone">✔    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">M2M   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_d_b_c.html">SDBC</a>   </td><td class="markdownTableBodyNone">✖   </td><td class="markdownTableBodyNone">✖    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Live Decode   </td><td class="markdownTableBodyNone">~   </td><td class="markdownTableBodyNone">✔   </td><td class="markdownTableBodyNone">✖   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md24"></a>
API</h1>
<p >The general API for logging is as follows</p>
<p ><code>x</code> : The extension that should be used for logging <br  />
 <code>ID</code> : The ID of the owner for this message <br  />
 <code>msg</code> : The string message, or telemetryID <br  />
 <code>...</code> : Depending on the usage, not used, the value of the telemetry entry, the optional value for a log, or vargs for a debug print</p>
<div class="fragment"><div class="line">Log.x(ID, msg, ...);</div>
</div><!-- fragment --><p >The API should be threadsafe, muxing the call as appropriate to ensure no race conditions when saving logged values.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Telemetry</h1>
<p >Includes things such as measurements, systems states, information not immediately useful to a person. Because, ultimately, we will have a set number of measurements that are taken, these mappings can be more static. In other words, these don't change often. Used for M2M communication.</p>
<p >Telemetry revolves around posting values to the <a class="el" href="namespace_s_d_b_c.html">SDBC</a> library, where it handles the encoding, <a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> messages, and some M2M communication.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Extensions</h2>
<p ><code>p</code> : Post a value</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Usage Example</h2>
<div class="fragment"><div class="line">// Generated by SDBC</div>
<div class="line">const int POST_EXAMPLE_TELEMETRY_VALUE = 0;</div>
<div class="line">const int POST_STEERING_WHEEL = 1;</div>
<div class="line"> </div>
<div class="line">// User call to post a value</div>
<div class="line">Log.p(ID, POST_STEERING_WHEEL, analogRead(5)); // Post</div>
</div><!-- fragment --><p >Posted values should call the SDBC library in the backend to both buffer and sync it as deemed appropriate. Beyond this, Log8 should only concern itself with saving this updated value to be logged, encoding is taken care of by SDBC.</p>
<p >Because calls must be threadsafe, internally, actual writing to a file only has to make pointer incrementation atomic to where data should be written, as encoded data is always the same size.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Encoding</h2>
<p >Encoding of the actual message follows SDBC encoding, where the telemetryID is the unique address used on the <a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> line and the 8 bytes of data for the value can be split up into multiple data types. The SDBC library should be given the correct function to call Log8 to store final encoded values to non-volatile storage.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
CAN BUS</h2>
<p >Each value is mapped to 8 byte blocks where each block has it's own unique address. This is handled by the SDBC library</p>
<h2><a class="anchor" id="autotoc_md30"></a>
SDBC</h2>
<p >**S**implified **D**ata**B**ase **C**AN (<a class="el" href="namespace_s_d_b_c.html">SDBC</a>) is a conceptual implementation of DBC, such as with <a href="https://www.vector.com/int/en/products/products-a-z/software/candb/">CANdb++</a>.</p>
<p >The main benefit of using this standard is the auto-generation of definitions that is specific to our system.</p>
<p >Because values on the <a class="el" href="namespace_s_d_b_c.html">SDBC</a> do not change frequently, the mapping file, the <code>.sdbc</code> file, does not have to be updated frequently, i.e each time the codebase is compiled.</p>
<p >The <code>.sdbc</code> file is structured in a way that is only relevant to us but is reminiscent of typical DBC.</p>
<p >Exact syntax is defined in the <a class="el" href="namespace_s_d_b_c.html">SDBC</a> <code>README.md</code></p>
<h2><a class="anchor" id="autotoc_md31"></a>
Flow of data</h2>
<ol type="1">
<li>Manually (or automatically?) create mappings of known and wanted values, including, data type, format, etc.</li>
<li>Generate all defines/IDs in a header file that represent each value given the mapping</li>
<li>Given the appropriate ID, the underlying logic for telemetry is able to process a value based on it's type, format, etc.</li>
<li>Decoding uses that same mapping, being able to more easily format and represent a value.</li>
</ol>
<h1><a class="anchor" id="autotoc_md32"></a>
Log</h1>
<p >Closer to an event log, pushing when something is happening on either ECU. Should retain previous logging protocol, as it is not static, programmer should be able to log anywhere.</p>
<p >Should not be used for M2M</p>
<p >Logs are to be entirely handled by Log8</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Extensions</h2>
<p ><code>i</code> : Log an info level message <br  />
 <code>w</code> : Log a warning level message <br  />
 <code>e</code> : Log an error level message <br  />
 <code>f</code> : Log a fatal level message</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Usage Example</h2>
<div class="fragment"><div class="line">Log.i(ID, &quot;epic!!1!&quot;, 45); // Info</div>
<div class="line">Log.w(ID, &quot;wooah&quot;, 22); // Warning</div>
<div class="line">Log.e(ID, &quot;AAAHH&quot;, var); // Error</div>
<div class="line">Log.f(ID, &quot;oof&quot;, -1); // Fatal</div>
</div><!-- fragment --><p >Messages <b>must</b> be string literals, these are picked up by a preprocessor to be mapped. This string shall not be a reference to a variable, it must be directly on the function call.</p>
<p >The optional value is limited to 32 bits, where it is 0 by default. The value can be a reference to a variable.</p>
<p >Do <b>NOT</b>, for whatever reason, deviate from the format shown here (such as with a multiline function call) to prevent issues when parsing these calls.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Encoding</h2>
<p >Encoding of these messages use the previous standard of logging. 2 bytes for ownerID, 2 bytes for stringID, and 4 bytes for the optional value (zero by default).</p>
<h2><a class="anchor" id="autotoc_md36"></a>
CAN BUS</h2>
<p >Sending log messages over <a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> will use a single unique address for each device, where messages are muxed based on the ownerID and stringID</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Flow of data</h2>
<ol type="1">
<li>Log calls in source are tokenized by a preprocessor</li>
<li>IDs and string literals are mapped to 16 bit integers and replaced in source</li>
<li>At runtime, calls to a log extension are interpreted as a single 64bit integer and both saved to non-volatile storage and pushed to <a class="el" href="namespace_c_a_n.html" title="Canbus functionality. Refer to Canbus.h for more info.">CAN</a> using the appropriate address</li>
</ol>
<h1><a class="anchor" id="autotoc_md38"></a>
Debug I/O</h1>
<p >Communication is over serial where this stream is not logged in anyway. Output should be minimal and <b>disabled if stream is not opened</b>.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Extensions</h2>
<p ><code>d</code> : Log a debug message</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Usage Example</h2>
<div class="fragment"><div class="line">Log.d(ID, &quot;Some message %d&quot;, 420); // Debug</div>
<div class="line"> </div>
<div class="line">Log.d(ID, 894); // Debug</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
Input</h2>
<p >For now, input is unrestricted, can take in whatever format as long as it can be interpreted.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Output</h2>
<p >Direct output over serial, printf like (no encoding necessary). ID still required.</p>
<p >Must acknowledge that the serial line has been opened.</p>
<p >Must acknowledge data that is received and whatever actions that were taken as a result.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Flow of data</h2>
<ol type="1">
<li>Debug acknowledges serial line is open</li>
<li>Data received by debug line is pushed to a parser for debug calls, data and actions acknowledged</li>
<li>Debug messages are printed to line directly </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
