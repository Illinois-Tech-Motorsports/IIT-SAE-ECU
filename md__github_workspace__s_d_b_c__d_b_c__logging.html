<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SAE Teensy ECU: DBC Logging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="DoxyLogo.png"/></td>
  <td id="projectalign">
   <div id="projectname">SAE Teensy ECU
   </div>
   <div id="projectbrief">IIT SAE Microcontroller programming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__github_workspace__s_d_b_c__d_b_c__logging.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">DBC <a class="el" href="namespace_logging.html" title="Namespace to isolate Log_t struct.">Logging</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md30"></a>
Goals</h1>
<ul>
<li>Better standardize how telemetry values are sent and decoded</li>
<li>More static mapping, reduce the necessity to extract known information</li>
<li>Separate telemetry from logging</li>
</ul>
<h1><a class="anchor" id="autotoc_md31"></a>
Distinction</h1>
<h2><a class="anchor" id="autotoc_md32"></a>
Telemetry</h2>
<p >Includes things such as measurements, systems states, information not immediately useful to a person. Because, ultimately, we will have a set number of measurements that are taken, these mappings can be more static. In other words, these don't change often. Could be used for M2M.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Logging</h2>
<p >More of an event log, pushing when something is happening on either ECU. Should retain previous logging protocol, as it is not static, programmer should be able to log anywhere. Should not be used for M2M.</p>
<h1><a class="anchor" id="autotoc_md34"></a>
Flow of data</h1>
<p >The following section only refers to telemetry.</p>
<ol type="1">
<li>Manually (or automatically?) create mappings of known and wanted values, including, data type, format, etc.</li>
<li>Generate all defines/IDs in a header file that represent each value given the mapping</li>
<li>Given the appropriate ID, the underlying logic for telemetry is able to process a value based on it's type, format, etc.</li>
<li>Decoding uses that same mapping, being able to more easily format and represent a value.</li>
</ol>
<h1><a class="anchor" id="autotoc_md35"></a>
Requirements</h1>
<p >Requirements that should be set, in order to improve functionality</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Message size</h2>
<p >Currently 8 Bytes. However, this does not need to be the case when saving a value to storage, or sending it over USB Serial. Over CAN, however, it must remain at 8 bytes, unless we actually use CAN addresses to differentiate between messages. This would mean more attention to what addresses we are using, but it would allow for more data to be sent at once over CAN. Doing so could free up the 4 bytes used for ID.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
CAN Nodes</h2>
<p >There are other nodes besides the ECUs and, potentially, even more nodes for future builds. Being able to get information directly from these submodules instead of having it pass through an ECU first would be beneficial. Additionally, it would help differentiate where messages are actually coming from, instead of "its from the ecu that takes it from the mc" or whatever other submodule.</p>
<p >This does mean that messages from other submodules must be mapped.</p>
<h1><a class="anchor" id="autotoc_md38"></a>
Solutions</h1>
<h2><a class="anchor" id="autotoc_md39"></a>
Spreadsheet mapping</h2>
<p >Each value is mapped out with their own variable name, type, unit, etc. Each type and unit is also defined within the same book. Data validation enables easier entry of values. How exactly values are "packaged" and passed over CAN is decided by grouping as many values into messages based on their value size (bits). This means another mapping is generated, indicating where and how to decode for any particular value.</p>
<h3><a class="anchor" id="autotoc_md40"></a>
Pros</h3>
<p >Using a spreadsheet, this enables for easier entry of values, as data validation helps ensure we use the defined types and units.</p>
<p >Not as "scary" as the other options, allows us to stick notes everywhere for new members</p>
<h3><a class="anchor" id="autotoc_md41"></a>
Cons</h3>
<p >Requires use of another generated mapping</p>
<p >Other sub systems are not accounted for, such as MCs and AMS. Their values would have to pass through an ECU before being recorded.</p>
<p >Being an excel file, this requires installing additional packages to run through a script.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Custom mapping</h2>
<p >Similar to the spreadsheet mapping, but does not use a spreadsheet but a custom format to store the same information.</p>
<h3><a class="anchor" id="autotoc_md43"></a>
Pros</h3>
<p >No special packages needed</p>
<p >Simple, just a text file that anyone can edit with a set syntax</p>
<h3><a class="anchor" id="autotoc_md44"></a>
Cons</h3>
<p >Parser must be made wherever this is needed</p>
<p >Still requires use of an additional mapping of where data actually is placed</p>
<p >subsystems unaccounted for</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Vector DBC</h2>
<p >Use a more industry standard method of organizing can messages</p>
<p >This standard organizes values into messages and signals, where messages are made up of signals and signals dictate things such as can ID, bit size, position, types, etc. specific to the standard.</p>
<p >Just a passive mapping, actual transmission of data is still done normally</p>
<h3><a class="anchor" id="autotoc_md46"></a>
Pros</h3>
<p >Standard, there are tools and libraries that are specific to this format. As such, a tool exists to help generate these mappings</p>
<p >Would account for other subsystems</p>
<p >static organization means no extra mappings should be generated</p>
<p >Has support to multiplex messages; signals in a message change depending on an indicator values within the message</p>
<h3><a class="anchor" id="autotoc_md47"></a>
Cons</h3>
<p >Values must be explicitly organized, with addresses, bit position and length. It can potentially get very involved just to change a single value.</p>
<p >attributes of a signal are limited to the standard, custom attributes can be made but it can complicate decoding if it has to be done manually</p>
<p >most libraries found for decoding and parsing are in python or c/c++</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Custom DBC</h2>
<p >Follow a similar structure to the Vector DBC but modified to fit our needs.</p>
<p >the dbc file is structured in a way that is only relevant to us. One example is, instead of stating exactly the number of bits and position of a signal within a message, we just define a signal by variable and format and which messages they should go in. Formats themselves would define their types, bit size, scale and offset, etc. The signals would just go in the order that they are defined in a message. Signals could also be defined separately from messages? All messages are 8 bytes and little endian</p>
<p >We could potentially convert it to vector dbc to allow use of other tools</p>
<h3><a class="anchor" id="autotoc_md49"></a>
Pros</h3>
<p >Less confusion with the format and, potentially, decoding of values.</p>
<p >Could improve readability of the raw dbc files for anyone to edit directly</p>
<p >Could potentially use the spreadsheet to initially make the mapping and then generate the sdbc file.</p>
<h3><a class="anchor" id="autotoc_md50"></a>
Cons</h3>
<p >All the tools and libraries for vector dbc will not work, as we are simply following it conceptually</p>
<p >We would have to validate message definitions, ensuring it all makes sense. Has to be done anyways, but we need to make sure of it as there are libraries to do that for us.</p>
<p >defining multiplexed messages might be confusing </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
